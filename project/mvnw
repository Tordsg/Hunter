#!/bin/sh
# ----------------------------------------------------------------------------
# Maven Wrapper script - downloads Maven and wrapper jar if needed, then runs Maven
# ----------------------------------------------------------------------------

MAVEN_PROJECTBASEDIR="${MAVEN_BASEDIR:-$(cd "$(dirname "$0")" && pwd)}"
WRAPPER_JAR="$MAVEN_PROJECTBASEDIR/.mvn/wrapper/maven-wrapper.jar"
WRAPPER_PROPERTIES="$MAVEN_PROJECTBASEDIR/.mvn/wrapper/maven-wrapper.properties"

# Download wrapper jar if missing
if [ ! -f "$WRAPPER_JAR" ]; then
  if [ -f "$WRAPPER_PROPERTIES" ]; then
    wrapperUrl=$(grep '^wrapperUrl=' "$WRAPPER_PROPERTIES" | cut -d'=' -f2)
    if [ -n "$wrapperUrl" ]; then
      echo "Downloading Maven Wrapper..."
      mkdir -p "$(dirname "$WRAPPER_JAR")"
      if command -v curl >/dev/null 2>&1; then
        curl -sL -o "$WRAPPER_JAR" "$wrapperUrl"
      elif command -v wget >/dev/null 2>&1; then
        wget -q -O "$WRAPPER_JAR" "$wrapperUrl"
      else
        echo "Error: curl or wget required to download Maven Wrapper"
        exit 1
      fi
    fi
  fi
fi

if [ ! -f "$WRAPPER_JAR" ]; then
  echo "Error: Maven Wrapper jar not found. Run from a machine with Maven to generate it: mvn wrapper:wrapper"
  exit 1
fi

# Use JAVA_HOME if set, otherwise find java
if [ -n "$JAVA_HOME" ] && [ -x "$JAVA_HOME/bin/java" ]; then
  JAVA_CMD="$JAVA_HOME/bin/java"
else
  JAVA_CMD="java"
fi

exec "$JAVA_CMD" -jar "$WRAPPER_JAR" "$@"
